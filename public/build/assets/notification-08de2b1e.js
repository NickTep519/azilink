import{p as c}from"./pusherClient-4ab91934.js";const a=parseInt(document.body.dataset.userId),i=document.getElementById("notifList"),h=new Audio("/sounds/notification.mp3"),g=document.getElementById("dropdownNotify");c.channel(`private-App.Models.User.${a}`)&&c.unsubscribe(`private-App.Models.User.${a}`);const y=c.subscribe(`private-App.Models.User.${a}`);function f(e,t=!1){const n=document.createElement("li");n.classList.add("notif-item","border-bottom");const o=t?e.data.message:e.message,u=t?e.data.url:e.url,p=e.id;t?e.data.created_at:e.created_at;const m=t?e.read_at!==null:!1;n.innerHTML=`
    <a href="${u||"#"}" class="d-block text-dark text-decoration-none p-2 notif-link ${m?"read":"unread"}" data-id="${p}">
        <div class="fw-bold">${o}</div>
        <small class="text-muted">${new Date(e.created_at||Date.now()).toLocaleString()}</small>
    </a>
`;const l=i.querySelector(".notif-item");l&&l.textContent.includes("Chargement")&&(i.innerHTML=""),i.prepend(n)}const s=document.getElementById("notifCount");let d=0;window.addEventListener("DOMContentLoaded",()=>{fetch("/notifications").then(e=>e.json()).then(({notifications:e,unread_count:t})=>{i.innerHTML="",e.forEach(n=>f(n,!0)),r(t),d=t})});function r(e){e>0?(s.textContent=e,s.style.display="inline-block"):(s.textContent="",s.style.display="none")}y.bind("Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",function(e){f(e),localStorage.getItem("notifSoundEnabled")==="true"&&h.play().catch(n=>console.error("Erreur audio :",n)),d++,r(d)});g.addEventListener("click",()=>{fetch("/notifications/read-all",{method:"POST",headers:{"X-CSRF-TOKEN":document.head.querySelector("meta[name='csrf-token']").content,Accept:"application/json"}}).then(()=>{r(0)})});i.addEventListener("click",function(e){const t=e.target.closest(".notif-link");if(!t)return;const n=t.dataset.id,o=t.getAttribute("href");n&&fetch(`/notifications/read/${n}`,{method:"POST",headers:{"X-CSRF-TOKEN":document.head.querySelector("meta[name='csrf-token']").content,Accept:"application/json"}}).then(()=>{}),o&&o!=="#"&&(window.location.href=o),e.preventDefault()});
